<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>동의서 관리</title>
    <link rel="stylesheet" th:href="@{/css/admin.css}">
</head>
<body>
<div class="app-shell">
    <div class="nav-bar">
        <div class="brand">
            Creditto Admin
        </div>
        <div class="pill-nav">
            <a th:href="@{/admin/dashboard}">대시보드</a>
            <a th:href="@{/admin/consents}">동의서 관리</a>
            <a th:href="@{/admin/remittances}">정기송금 관리</a>
            <a th:href="@{/admin/monitoring}">모니터링</a>
        </div>
    </div>

    <section class="hero">
        <h1>동의서 관리</h1>
        <p>동의서 조회 / 생성 / 수정 / 삭제</p>
    </section>

    <div th:if="${message}" class="message glass" th:text="${message}"></div>

    <section class="section glass">
        <h2>새 동의서 추가</h2>
        <form th:action="@{/admin/consents}" th:object="${createForm}" method="post">
            <div class="form-grid">
                <div>
                    <label>카테고리</label>
                    <select th:field="*{consentCategory}" required>
                        <option value="" disabled selected>선택</option>
                        <option th:each="category : ${categories}"
                                th:value="${category}"
                                th:text="${category.name()}">
                        </option>
                    </select>
                    <p class="small" th:if="${#fields.hasErrors('consentCategory')}" th:errors="*{consentCategory}"></p>
                </div>
                <div>
                    <label>버전</label>
                    <input type="number" min="1" th:field="*{consentDefVer}" placeholder="1" required>
                    <p class="small" th:if="${#fields.hasErrors('consentDefVer')}" th:errors="*{consentDefVer}"></p>
                </div>
            </div>
                <div>
                    <label>동의서 제목</label>
                    <input th:field="*{consentTitle}" placeholder="고객 정보 제공에 관한 동의" required>
                <p class="small" th:if="${#fields.hasErrors('consentTitle')}" th:errors="*{consentTitle}"></p>
            </div>
                <div>
                    <label>동의서 본문</label>
                    <textarea th:field="*{consentDesc}" placeholder="동의서 내용을 입력하세요" required></textarea>
                <p class="small" th:if="${#fields.hasErrors('consentDesc')}" th:errors="*{consentDesc}"></p>
            </div>
            <div class="form-grid">
                <div>
                    <label>유효 시작일</label>
                    <input type="datetime-local" th:field="*{validFrom}" required>
                    <p class="small" th:if="${#fields.hasErrors('validFrom')}" th:errors="*{validFrom}"></p>
                </div>
                <div>
                    <label>유효 종료일(옵션)</label>
                    <input type="datetime-local" th:field="*{validTo}">
                    <p class="small" th:if="${#fields.hasErrors('validTo')}" th:errors="*{validTo}"></p>
                </div>
            </div>
            <div class="actions">
                <button type="submit" class="btn-success">동의서 정의 추가</button>
            </div>
        </form>
    </section>

    <section class="section glass">
        <h2>동의서 목록</h2>
        <table>
            <thead>
            <tr>
                <th>ID</th>
                <th>제목</th>
                <th>카테고리</th>
                <th>버전</th>
                <th>유효 기간</th>
                <th>작업</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="consent : ${consents}">
                <td th:text="${consent.id}"></td>
                <td th:text="${consent.consentTitle}"></td>
                <td th:text="${consent.consentCategory.name()}"></td>
                <td th:text="${consent.consentDefVer}"></td>
                <td>
                    <div th:text="${#temporals.format(consent.validFrom, 'yyyy-MM-dd HH:mm')}"></div>
                    <div class="small" th:text="${consent.validTo != null ? #temporals.format(consent.validTo, 'yyyy-MM-dd HH:mm') : '무기한'}"></div>
                </td>
                <td>
                    <div class="actions">
                        <a class="btn btn-secondary" th:href="@{|/admin/consents/${consent.id}/edit|}">수정</a>
                        <form th:action="@{|/admin/consents/${consent.id}/delete|}" method="post"
                              onsubmit="return confirm('정말 삭제하시겠습니까?');">
                            <button type="submit" class="btn-danger">삭제</button>
                        </form>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </section>
</div>
</body>
</html>
